# ShogiView

Obsidian の Markdown ノートに KIF 形式の棋譜を貼り付けると、インタラクティブな将棋盤で局面を再生できるプラグインです。対局の振り返りや参考棋譜の閲覧を、Obsidian の中で完結させることを目的としています。

## 主な機能

- ` ```kif` コードブロックに書かれた KIF 形式の棋譜を解析して表示
- 盤面と双方の持ち駒をリアルタイムに更新し、直前の移動元・移動先をハイライト
- 「最初 / 一手戻る / 一手進む / 最後」ボタンで手順を順送り・巻き戻し
- 任意の手数を指定してその局面から再生を開始可能
- 分岐棋譜に対応し、現在の分岐を示すパンくず表示・親手順へ戻るボタン・分岐選択ドロップダウンを提供
- 棋譜ツリーを展開／折りたたみしながら閲覧できる変化一覧ビュー
- 最新手のコメントや消費時間、棋戦・戦型などのメタ情報を表示

## 使い方

1. プラグインをビルドし、生成された `main.js`, `manifest.json`, `styles.css` (任意) を Obsidian Vault の `/.obsidian/plugins/shogi-kif-viewer/` フォルダに配置します。フォルダ名は `manifest.json` の `id` (`shogi-kif-viewer`) と一致させないとプラグインが読み込まれません。
2. Obsidian を再起動し、**設定 → Community plugins** からプラグインを有効化します。
3. ノートに以下のようなコードブロックを追加します。

   ````markdown
   ```kif
   # ----  ぴよ将棋 棋譜ファイル  ----
   棋戦：ぴよ将棋
   戦型：△ツノ銀雁木
   開始日時：2025/09/20 17:38:04
   終了日時：2025/09/20 17:54:54
   手合割：平手
   先手：プレイヤー
   後手：プレイヤー
   手数----指手---------消費時間--
      1 ２六歩(27)( 0:12/00:00:12)
      2 ３四歩(33)( 0:05/00:00:05)
      3 ２五歩(26)( 0:01/00:00:13)
   ```
   ````

4. プレビューまたは Reading モードでノートを開くと、盤面・持ち駒・棋譜一覧が表示されます。ボタンや変化一覧を操作して局面を再生してください。

### KIF 記法について

- 基本的な KIF header (`棋戦`, `戦型` など) と棋譜行をサポートしています。
- 「同」や `打`、成り (`成`)・不成 (`不成`) 表記、座標付きの元位置 `(27)`、時間表記 `( 0:12/00:00:12)` を解析します。
- `* コメント` 形式のコメント行は直前の手にひも付き、コメント欄に表示されます。
- `変化：n手` から始まる分岐はツリー状に展開され、任意の分岐へ移動できます。
- コードブロック先頭付近に `初期表示手：15` や `start-move: 15` のような記述を入れると、その手数から盤面を初期表示できます。

## 開発者向け情報

### 動作環境

- Node.js 18 以上を推奨
- npm (このリポジトリは npm scripts を利用しています)

### セットアップ

```bash
npm install
```

### 開発用ビルド (watch)

```bash
npm run dev
```

### 本番ビルド

```bash
npm run build
```

ビルド後は生成された `main.js` と `manifest.json` (および必要に応じて `styles.css`) を対象の Vault にコピーして動作確認してください。

## ライセンス

MIT License (詳細は `LICENSE` を参照してください)。
