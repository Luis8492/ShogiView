/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ye=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var lt=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var ut=(t,o)=>{for(var c in o)ye(t,c,{get:o[c],enumerable:!0})},ft=(t,o,c,b)=>{if(o&&typeof o=="object"||typeof o=="function")for(let f of lt(o))!dt.call(t,f)&&f!==c&&ye(t,f,{get:()=>o[f],enumerable:!(b=ct(o,f))||b.enumerable});return t};var pt=t=>ft(ye({},"__esModule",{value:!0}),t);var kt={};ut(kt,{default:()=>de,demoteKind:()=>le,initialBoard:()=>Ce,parseKif:()=>qe,promoteKind:()=>Se});module.exports=pt(kt);var Oe=require("obsidian"),ue="\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19",Le="\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",mt=Array.from(ue).reverse(),vt=Array.from(Le);function Ne(t){let o=ue.indexOf(t);if(o>=0)return o+1;let c=Le.indexOf(t);if(c>=0)return c+1;let b=parseInt(t,10);if(!isNaN(b)&&b>=1&&b<=9)return b;throw new Error("Invalid digit: "+t)}function ht(t){if(t.length<2)throw new Error("square short");let o=Ne(t[0]),c=Ne(t[1]);return{f:o,r:c}}function Ce(){let t=Array.from({length:9},()=>Array(9).fill(null)),o=(c,b,f,w)=>{t[b-1][c-1]={kind:f,side:w}};o(1,1,"\u9999","W"),o(2,1,"\u6842","W"),o(3,1,"\u9280","W"),o(4,1,"\u91D1","W"),o(5,1,"\u738B","W"),o(6,1,"\u91D1","W"),o(7,1,"\u9280","W"),o(8,1,"\u6842","W"),o(9,1,"\u9999","W"),o(8,2,"\u98DB","W"),o(2,2,"\u89D2","W");for(let c=1;c<=9;c++)o(c,3,"\u6B69","W");for(let c=1;c<=9;c++)o(c,7,"\u6B69","B");return o(2,8,"\u98DB","B"),o(8,8,"\u89D2","B"),o(1,9,"\u9999","B"),o(2,9,"\u6842","B"),o(3,9,"\u9280","B"),o(4,9,"\u91D1","B"),o(5,9,"\u7389","B"),o(6,9,"\u91D1","B"),o(7,9,"\u9280","B"),o(8,9,"\u6842","B"),o(9,9,"\u9999","B"),t}function Se(t){switch(t){case"\u6B69":return"\u3068";case"\u9999":return"\u6210\u9999";case"\u6842":return"\u6210\u6842";case"\u9280":return"\u6210\u9280";case"\u89D2":return"\u99AC";case"\u98DB":return"\u9F8D";default:return t}}function le(t){switch(t){case"\u3068":return"\u6B69";case"\u6210\u9999":return"\u9999";case"\u6210\u6842":return"\u6842";case"\u6210\u9280":return"\u9280";case"\u99AC":return"\u89D2";case"\u9F8D":return"\u98DB";default:return t}}var bt=/(右|左|直|上|引|寄)/g;function gt(t){let o=t;if(!t)return null;let c=t,b=!1,f=!1;c.endsWith("\u4E0D\u6210")?(f=!0,c=c.slice(0,-2)):c.endsWith("\u6210")&&(b=!0,c=c.slice(0,-1)),c=c.replace(bt,"");let w;switch(c){case"\u6B69":case"\u9999":case"\u6842":case"\u9280":case"\u91D1":case"\u89D2":case"\u98DB":case"\u7389":case"\u738B":case"\u3068":case"\u6210\u9999":case"\u6210\u6842":case"\u6210\u9280":case"\u99AC":case"\u9F8D":w=c;break;default:return null}let V=w;if(b&&!f){let A=Se(w);A!==w?V=A:b=!1}return f&&(b=!1),{kind:V,raw:o,promoted:b?!0:void 0,promotionDeclined:f?!0:void 0}}var xt=["\u98DB","\u89D2","\u91D1","\u9280","\u6842","\u9999","\u6B69","\u7389","\u738B"],Mt=new Set(["\u3068","\u6210\u9999","\u6210\u6842","\u6210\u9280","\u99AC","\u9F8D"]);function $e(t){return Mt.has(t)}function qe(t){var R,U;let o={},c={startMoveNumber:1,moves:[],leadVariations:[],isExpanded:!0},b={line:c},f=[b],w=t.split(/\r?\n/),V="((?:\u6210\u9999|\u6210\u6842|\u6210\u9280|\u99AC|\u9F8D|\u3068|\u6B69|\u9999|\u6842|\u9280|\u91D1|\u89D2|\u98DB|\u7389|\u738B)(?:\u53F3|\u5DE6|\u76F4|\u4E0A|\u5F15|\u5BC4)*(?:\u6210|\u4E0D\u6210)?)",A=new RegExp(`^\\s*(\\d+)\\s+((?:\u540C(?:\\s|\u3000)?)|[${ue}1-9${Le}]{2})${V}(\u6253?)(?:\\((\\d{2})\\))?(?:\\(([^\\)]*)\\))?`),X=/^変化：(\d+)手/;for(let $ of w){let H=$.trimEnd(),x=H.trim();if(!x||x.startsWith("#")||x.startsWith("----"))continue;let l=x.match(X);if(l){let g=parseInt(l[1],10),I=g-1,P,k;if(g===1)P=b;else for(let y=f.length-1;y>=0;y--){let D=f[y],N=D.line.moves.find(te=>te.n===I);if(N){P=D,k=N;break}}for(P||(P=b,k=void 0);f.length&&f[f.length-1]!==P;)f.pop();let Q=k?P.line.moves.indexOf(k)+1:0,z={startMoveNumber:g,moves:[],parent:{line:P.line,anchorMoveCount:Q},leadVariations:[],isExpanded:!1};k?k.variations.push(z):P.line.leadVariations.push(z),f.push({line:z,prevMove:k});continue}if(x.includes("\uFF1A")){let[g,I]=x.split("\uFF1A");g&&I&&(o[g.trim()]=I.trim());continue}if(x.startsWith("*")){let g=f[f.length-1];g.prevMove&&(g.prevMove.comment=(g.prevMove.comment?g.prevMove.comment+`
`:"")+x.slice(1).trim());continue}let h=H.match(A);if(h){let g=f[f.length-1],I=parseInt(h[1],10),P=h[2].replace(/[\s　]/g,""),k;if(P==="\u540C")(R=g.prevMove)!=null&&R.to&&(k={...g.prevMove.to});else try{k=ht(P)}catch(j){k=void 0}if(!k)continue;let Q=gt(h[3]);if(!Q)continue;let{kind:z,raw:y,promoted:D,promotionDeclined:N}=Q,te=h[4]==="\u6253",_;if(h[5]){let j=parseInt(h[5][0],10),B=parseInt(h[5][1],10);_={f:j,r:B}}let ne=(U=h[6])==null?void 0:U.trim(),re={n:I,to:k,from:_,kind:z,rawKind:y,promoted:D,promotionDeclined:N,drop:te,timestamp:ne,rawTo:P||void 0,variations:[],areVariationsExpanded:!1};g.line.moves.push(re),g.prevMove=re}}return{header:o,root:c}}function He(t){return t>=1&&t<=9?ue[t-1]:t.toString()}function Et(t){return`${He(t.f)}${He(t.r)}`}function _e(t){var w,V;let o=t.rawTo==="\u540C"?"\u540C":Et(t.to),c=(V=(w=t.rawKind)!=null?w:t.kind)!=null?V:"",b=t.drop?"\u6253":"",f=!t.drop&&t.from?`(${t.from.f}${t.from.r})`:"";return`${o}${c}${b}${f}`}var de=class extends Oe.Plugin{async onload(){this.registerMarkdownCodeBlockProcessor("kif",(o,c,b)=>this.renderKif(o,c,b))}renderKif(o,c,b){let f=c.createDiv({cls:"shogi-kif"}),w=o.match(/^[\t ]*(?:[#;]|\/\/)?[\t ]*(?:start(?:-?move)?|開始手(?:数)?|表示開始手(?:数)?|初期表示手(?:数)?)[\t ]*(?:[:：=])[\t ]*(\d+)/im),V=w?parseInt(w[1],10):void 0,{header:A,root:X}=qe(o),R=Ce(),U={B:[],W:[]},$,H,x,l=X,h=0,g=new WeakMap,I=f.createDiv({cls:"toolbar"}),P=I.createEl("button",{text:"\u23EE \u6700\u521D",attr:{type:"button","aria-label":"\u6700\u521D\u306E\u624B\u3078\u79FB\u52D5 (Home)",title:"\u6700\u521D\u306E\u624B\u3078\u79FB\u52D5 (Home)"}}),k=I.createEl("button",{text:"\u25C0 \u4E00\u624B\u623B\u308B",attr:{type:"button","aria-label":"\u4E00\u624B\u623B\u308B (ArrowLeft)",title:"\u4E00\u624B\u623B\u308B (ArrowLeft)"}}),Q=I.createEl("button",{text:"\u4E00\u624B\u9032\u3080 \u25B6",attr:{type:"button","aria-label":"\u4E00\u624B\u9032\u3080 (ArrowRight)",title:"\u4E00\u624B\u9032\u3080 (ArrowRight)"}}),z=I.createEl("button",{text:"\u6700\u5F8C \u23ED",attr:{type:"button","aria-label":"\u6700\u5F8C\u306E\u624B\u3078\u79FB\u52D5 (End)",title:"\u6700\u5F8C\u306E\u624B\u3078\u79FB\u52D5 (End)"}}),y=I.createEl("button",{text:"\u25B6 \u81EA\u52D5\u518D\u751F",attr:{type:"button","aria-label":"\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)",title:"\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"}}),D=I.createDiv({cls:"start-move-control"});D.createSpan({cls:"start-move-label",text:"\u8868\u793A\u958B\u59CB\u624B:"});let N=D.createEl("input",{cls:"start-move-input",attr:{type:"number",min:"0",step:"1",placeholder:"\u624B\u6570",inputmode:"numeric"}}),te=D.createEl("button",{cls:"start-move-apply",text:"\u79FB\u52D5",attr:{type:"button"}}),_=D.createSpan({cls:"start-move-feedback"}),ne=f.createDiv({cls:"variation-bar"}),re=ne.createSpan({cls:"variation-current"}),j=ne.createEl("button",{text:"\u21A9 \u89AA\u306E\u624B\u9806\u3078"});j.addClass("variation-parent");let B=ne.createEl("select");B.addClass("variation-select");let fe=[],Fe=this,Ue=1500,O=!1,ie=null;function pe(){O?(y.setText("\u23F8 \u505C\u6B62"),y.setAttr("aria-label","\u81EA\u52D5\u518D\u751F\u3092\u505C\u6B62 (Space)"),y.setAttr("title","\u81EA\u52D5\u518D\u751F\u3092\u505C\u6B62 (Space)"),y.setAttr("aria-pressed","true")):(y.setText("\u25B6 \u81EA\u52D5\u518D\u751F"),y.setAttr("aria-label","\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"),y.setAttr("title","\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"),y.setAttr("aria-pressed","false"))}function C(){ie!==null&&(window.clearInterval(ie),ie=null),O&&(O=!1,pe())}function ze(){if(O)return;O=!0;let e=window.setInterval(()=>{if(h>=l.moves.length){C();return}L(Math.min(l.moves.length,h+1)),S()},Ue);ie=e,Fe.registerInterval(e),pe()}function we(){O?C():ze()}let J=f.createDiv({cls:"board-layout"}),me=J.createDiv({cls:"board-area"}),se=me.createDiv({cls:"board-wrapper"}),je=se.createDiv({cls:"hands hands-opponent"}),Y=se.createDiv({cls:"board-with-coordinates"}),Je=se.createDiv({cls:"hands hands-player"}),Ge={W:je,B:Je},Pe,Xe=me.createDiv({cls:"meta"}),q=J.createDiv({cls:"board-move-splitter"});q.setAttr("role","separator"),q.setAttr("aria-hidden","true"),q.setAttr("aria-orientation","horizontal"),q.setAttr("aria-label","\u76E4\u3068\u68CB\u8B5C\u30EA\u30B9\u30C8\u306E\u5883\u754C"),q.tabIndex=-1;let ve=J.createDiv({cls:"move-list"});ve.createDiv({cls:"move-list-title",text:"\u68CB\u8B5C"});let Z=ve.createDiv({cls:"move-list-body"}),De=f.createDiv({cls:"comments-container"}).createDiv({cls:"meta comments"}),he=!1,be=!1;function Qe(){let e=J.clientWidth,n=se.getBoundingClientRect().width,a=window.getComputedStyle(ve),d=parseFloat(a.minWidth||"0"),r=window.getComputedStyle(J),i=parseFloat(r.columnGap||r.gap||"0"),s=e>0&&n>0?e<n+d+i:e<d+i;s!==he&&(he=s,J.toggleClass("is-stacked",he),q.setAttr("aria-hidden","true"),q.setAttr("aria-orientation","horizontal"),q.tabIndex=-1)}function ee(){be||(be=!0,window.requestAnimationFrame(()=>{be=!1,Qe()}))}let Te=new ResizeObserver(()=>{ee()});Te.observe(J),this.register(()=>Te.disconnect());let Ie=new ResizeObserver(()=>{ee()});Ie.observe(me),this.register(()=>Ie.disconnect()),this.registerDomEvent(window,"resize",()=>{ee()}),ee();function ge(e){if(!e.parent)return"\u672C\u7B4B";let n=e.moves[0],a=n?_e(n):"";return a?`\u5909\u5316 ${e.startMoveNumber}\u624B: ${a}`:`\u5909\u5316 ${e.startMoveNumber}\u624B`}function xe(e,n){let a=Math.max(0,Math.min(n,e.moves.length)),d=e.moves.slice(0,a);if(!e.parent)return d;let r=Math.max(0,Math.min(e.parent.anchorMoveCount,e.parent.line.moves.length));return xe(e.parent.line,r).concat(d)}function Ye(){let e=A.\u6301\u3061\u6642\u9593,n=(m,E)=>{let W=A[E==="B"?"\u5148\u624B":"\u5F8C\u624B"],F=E==="B"?["\u5148\u624B\u6301\u3061\u6642\u9593","\u5148\u624B\u6301\u6642\u9593"]:["\u5F8C\u624B\u6301\u3061\u6642\u9593","\u5F8C\u624B\u6301\u6642\u9593"],v;for(let oe of F){let ae=A[oe];if(ae){v=ae;break}}return!v&&E==="B"&&e&&(v=e),W&&m.createSpan({cls:"player-name",text:W}),v&&m.createSpan({cls:"player-time",text:v}),m.childElementCount>0},a=m=>{for(let E of mt)m.createSpan({cls:"board-coordinate board-coordinate-file",text:E})},d=m=>{for(let E of vt)m.createSpan({cls:"board-coordinate board-coordinate-rank",text:E})};Y.empty();let r=Y.createDiv({cls:"player-info player-info-opponent"});n(r,"W")||r.remove();let i=Y.createDiv({cls:"board-files board-files-top"});a(i);let s=Y.createDiv({cls:"board-middle"}),p=s.createDiv({cls:"board-ranks board-ranks-left"});d(p),Pe=s.createDiv({cls:"board"});let u=s.createDiv({cls:"board-ranks board-ranks-right"});d(u);let M=Y.createDiv({cls:"board-files board-files-bottom"});a(M);let T=Y.createDiv({cls:"player-info player-info-player"});n(T,"B")||T.remove();for(let m=1;m<=9;m++)for(let E=9;E>=1;E--){let G=Pe.createDiv({cls:"cell"}),W=R[m-1][E-1];if(W){let F=G.createSpan({cls:"piece",text:W.kind});W.side==="W"?F.addClass("piece-opponent"):F.addClass("piece-player"),$e(W.kind)&&F.addClass("piece-promoted")}H&&H.f===E&&H.r===m&&G.addClass("highlight-to"),$&&$.f===E&&$.r===m&&G.addClass("highlight-from")}}function Ze(){var n;let e=["W","B"];for(let a of e){let d=Ge[a];d.empty();let r=U[a];if(!r.length){let s=d.createSpan({cls:"hands-empty",text:"\u306A\u3057"});a==="W"&&s.addClass("hand-piece-opponent");continue}let i=new Map;for(let s of r)i.set(s,((n=i.get(s))!=null?n:0)+1);for(let s of xt){let p=i.get(s);if(!p)continue;let u=d.createSpan({cls:"hand-piece",text:p>1?`${s}${p}`:s});a==="W"&&u.addClass("hand-piece-opponent"),i.delete(s)}for(let[s,p]of i){let u=d.createSpan({cls:"hand-piece",text:p>1?`${s}${p}`:s});a==="W"&&u.addClass("hand-piece-opponent")}}}function et(){let e=[A.\u68CB\u6226?`\u68CB\u6226: ${A.\u68CB\u6226}`:void 0,A.\u6226\u578B?`\u6226\u578B: ${A.\u6226\u578B}`:void 0,x!=null&&x.timestamp?`\u6D88\u8CBB\u6642\u9593: ${x.timestamp}`:void 0].filter(Boolean).join(" / ");Xe.setText(e)}function tt(){if(De.empty(),x!=null&&x.comment){let e=De.createEl("pre");e.textContent=x.comment}}function Ve(e,n){C(),g.set(l,h),l=e;let a=Math.max(0,Math.min(n+1,l.moves.length));L(a),S()}function Me(e,n){let a=e.moves.findIndex(d=>d.n===n);if(a>=0)return{line:e,moveIndex:a};for(let d of e.moves)for(let r of d.variations){let i=Me(r,n);if(i)return i}for(let d of e.leadVariations){let r=Me(d,n);if(r)return r}return null}function Ae(e){if(!Number.isFinite(e)||e<0)return!1;if(C(),e===0)return L(0),S(),!0;let n=Me(X,e);if(!n)return!1;if(n.line===l){let a=Math.max(0,Math.min(n.moveIndex+1,l.moves.length));L(a),S()}else Ve(n.line,n.moveIndex);return!0}function Be(e){if(e.moves.length>0)return!0;for(let n of e.leadVariations)if(Be(n))return!0;return!1}function Ee(){var p;if(Z.empty(),!Be(X)){Z.createSpan({cls:"move-list-empty",text:"\u68CB\u8B5C\u306F\u3042\u308A\u307E\u305B\u3093\u3002"}),ee();return}let e=new Set(xe(l,h)),n=new Set,a=l;for(;a;)n.add(a),a=(p=a.parent)==null?void 0:p.line;let d=Z.createDiv({cls:"variation-tree"}),r=20,i=(u,M,T)=>{let m=M.createDiv({cls:"variation-node"}),E=Math.min(T,r);m.addClass(`indent-level-${E}`),n.has(u)&&m.addClass("is-active-line"),u===l&&m.addClass("is-current-line");let G=u.leadVariations.length>0||u.moves.length>0,W=m.createDiv({cls:"variation-header"});if(G){let v=W.createEl("button",{cls:"variation-toggle",text:u.isExpanded?"\u25BC":"\u25B6",attr:{type:"button","aria-expanded":String(u.isExpanded),"aria-label":u.isExpanded?"\u5909\u5316\u3092\u6298\u308A\u305F\u305F\u3080":"\u5909\u5316\u3092\u5C55\u958B\u3059\u308B"}});v.onclick=oe=>{oe.stopPropagation(),u.isExpanded=!u.isExpanded,Ee()}}else W.createSpan({cls:["variation-toggle","variation-toggle-placeholder"]}),m.addClass("is-leaf");if(W.createSpan({cls:"variation-title",text:ge(u)}),!G)return;if(!u.isExpanded){m.addClass("is-collapsed");return}let F=m.createDiv({cls:"variation-children"});for(let v of u.leadVariations)i(v,F,T+1);u.moves.forEach((v,oe)=>{let ae=F.createDiv({cls:"variation-move-group"}),K=ae.createDiv({cls:"variation-move"});e.has(v)&&K.addClass("is-done"),x&&x===v&&K.addClass("is-current"),K.onclick=()=>{Ve(u,oe)},K.createSpan({cls:"move-number",text:v.n.toString()});let at=v.n%2===1?"\u25B2":"\u25B3",rt=v.n%2===1?"move-prefix-sente":"move-prefix-gote";K.createSpan({cls:["move-prefix",rt],text:at});let it=K.createSpan({cls:"move-text",text:_e(v)});v.kind&&$e(v.kind)&&it.addClass("move-text-promoted");let Ke=v.variations.length>0,Re=Ke&&v.variations.some(ke=>n.has(ke));if(Ke){K.addClass("has-branch"),Re&&K.addClass("has-active-branch");let ke=K.createEl("button",{cls:"variation-branch-toggle",text:v.areVariationsExpanded?"\u25BC":"\u25B6",attr:{type:"button","aria-expanded":String(v.areVariationsExpanded),"aria-label":v.areVariationsExpanded?"\u3053\u306E\u624B\u306E\u5909\u5316\u3092\u6298\u308A\u305F\u305F\u3080":"\u3053\u306E\u624B\u306E\u5909\u5316\u3092\u5C55\u958B\u3059\u308B"}});if(ke.onclick=ce=>{ce.stopPropagation(),v.areVariationsExpanded=!v.areVariationsExpanded,Ee()},v.areVariationsExpanded){let ce=ae.createDiv({cls:"variation-branch"});Re&&ce.addClass("is-active-branch");for(let st of v.variations)i(st,ce,T+1)}}else K.createSpan({cls:"variation-branch-placeholder"})})};i(X,d,0);let s=Z.querySelector(".variation-move.is-current");if(s){let u=Z.getBoundingClientRect(),M=s.getBoundingClientRect();if(M.top<u.top||M.bottom>u.bottom){let T=O?"smooth":"auto";s.scrollIntoView({block:"nearest",inline:"nearest",behavior:T})}}else h===0&&(Z.scrollTop=0);ee()}function L(e){var d;h=Math.max(0,Math.min(e,l.moves.length)),g.set(l,h),R=Ce(),U={B:[],W:[]},$=void 0,H=void 0,x=void 0;let a=xe(l,h);for(let r of a){let i=r.n%2===1?"B":"W",s=null;if(r.drop){let M=le((d=r.kind)!=null?d:"\u6B69"),T=U[i],m=T.findIndex(E=>E===M);m>=0&&T.splice(m,1),s={side:i,kind:M},$=void 0}else if(r.from){let M=R[r.from.r-1][r.from.f-1];if(!M)continue;s={...M},R[r.from.r-1][r.from.f-1]=null,$=r.from}else continue;let p=r.to,u=R[p.r-1][p.f-1];if(u&&u.side!==i){let M=le(u.kind);U[i].push(M)}s&&(!r.drop&&r.promoted&&(s.kind=Se(s.kind)),!r.drop&&r.promotionDeclined&&!r.kind&&(s.kind=le(s.kind)),r.kind&&(s.kind=r.kind),R[p.r-1][p.f-1]=s),H=p,x=r}Ye(),Ze(),et(),tt(),O&&h>=l.moves.length&&C()}function S(){var r;let e=l;for(;e;){e.isExpanded=!0;let i=e.parent;if(i){let s=i.anchorMoveCount-1;if(s>=0){let p=i.line.moves[s];p&&(p.areVariationsExpanded=!0)}}e=i==null?void 0:i.line}let n=[];for(e=l;e;)n.push(ge(e)),e=(r=e.parent)==null?void 0:r.line;re.setText(`\u73FE\u5728: ${n.reverse().join(" \u2192 ")}`);let a=l.parent;j.disabled=!a,j.toggleClass("is-hidden",!a),B.empty(),fe=[];let d=[];d.push(...l.leadVariations);for(let i of l.moves)d.push(...i.variations);d.length?(B.removeClass("is-hidden"),B.createEl("option",{text:"\u5909\u5316\u3092\u9078\u629E",value:""}),d.forEach((i,s)=>{var M,T,m;fe.push(i);let p=ge(i),u=(T=(M=i.parent)==null?void 0:M.anchorMoveCount)!=null?T:0;((m=i.parent)==null?void 0:m.line)===l&&u>h&&(p+="\uFF08\u672A\u5230\u9054\uFF09"),B.createEl("option",{text:p,value:String(s)})}),B.value=""):(B.addClass("is-hidden"),B.value=""),Ee()}function nt(e){C(),g.set(l,h),l=e;let n=g.get(l),a=n!==void 0?Math.max(0,Math.min(n,l.moves.length)):0;L(a),S()}function ot(){let e=l.parent;if(!e)return;C(),g.set(l,h),l=e.line;let n=g.get(l),a=n!==void 0?Math.max(0,Math.min(n,l.moves.length)):Math.min(e.anchorMoveCount,l.moves.length);L(a),S()}P.onclick=()=>{C(),L(0),S()},k.onclick=()=>{C(),L(Math.max(0,h-1)),S()},Q.onclick=()=>{C(),L(Math.min(l.moves.length,h+1)),S()},z.onclick=()=>{C(),L(l.moves.length),S()},y.onclick=()=>{we()},j.onclick=()=>{ot()},B.onchange=()=>{let e=B.value;if(!e)return;let n=parseInt(e,10);if(Number.isNaN(n))return;let a=fe[n];a&&nt(a)};function We(){let e=N.value.trim();if(!e){D.removeClass("has-error"),_.setText("");return}let n=parseInt(e,10);if(Number.isNaN(n)){D.addClass("has-error"),_.setText("\u624B\u6570\u306F\u6570\u5B57\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}Ae(n)?(D.removeClass("has-error"),_.setText(""),N.value=n.toString()):(D.addClass("has-error"),_.setText("\u6307\u5B9A\u3057\u305F\u624B\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002"))}te.onclick=e=>{e.preventDefault(),We()},N.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),We())}),this.registerDomEvent(document,"keydown",e=>{if(e.defaultPrevented)return;let n=e.target,a=n instanceof HTMLElement?n:null,d=document.activeElement instanceof HTMLElement?document.activeElement:null,r=p=>{if(!p)return!1;if(p.isContentEditable)return!0;let u=p.tagName;return u==="INPUT"||u==="TEXTAREA"||u==="SELECT"};if(r(a)||a&&a.closest('input, textarea, select, [contenteditable="true"]')||r(d)||d&&d.closest('input, textarea, select, [contenteditable="true"]'))return;let i=p=>p?f.contains(p):!1,s=n===document.body;if(i(a)||i(d)||s)switch(e.key){case"ArrowLeft":e.preventDefault(),C(),L(Math.max(0,h-1)),S();break;case"ArrowRight":e.preventDefault(),C(),L(Math.min(l.moves.length,h+1)),S();break;case"Home":e.preventDefault(),C(),L(0),S();break;case"End":e.preventDefault(),C(),L(l.moves.length),S();break;case" ":case"Space":case"Spacebar":e.preventDefault(),we();break;default:break}}),pe(),L(0),S(),V!==void 0&&!Number.isNaN(V)&&(N.value=V.toString(),Ae(V)||(D.addClass("has-error"),_.setText("\u6307\u5B9A\u3057\u305F\u624B\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002")))}};
