/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ee=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var lt=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var ut=(t,o)=>{for(var c in o)Ee(t,c,{get:o[c],enumerable:!0})},ft=(t,o,c,v)=>{if(o&&typeof o=="object"||typeof o=="function")for(let f of lt(o))!dt.call(t,f)&&f!==c&&Ee(t,f,{get:()=>o[f],enumerable:!(v=ct(o,f))||v.enumerable});return t};var pt=t=>ft(Ee({},"__esModule",{value:!0}),t);var Et={};ut(Et,{default:()=>fe,demoteKind:()=>ue,initialBoard:()=>ke,parseKif:()=>qe,promoteKind:()=>Se});module.exports=pt(Et);var Oe=require("obsidian"),pe="\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19",Ce="\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",mt=Array.from(pe).reverse(),vt=Array.from(Ce);function Ne(t){let o=pe.indexOf(t);if(o>=0)return o+1;let c=Ce.indexOf(t);if(c>=0)return c+1;let v=parseInt(t,10);if(!isNaN(v)&&v>=1&&v<=9)return v;throw new Error("Invalid digit: "+t)}function ht(t){if(t.length<2)throw new Error("square short");let o=Ne(t[0]),c=Ne(t[1]);return{f:o,r:c}}function ke(){let t=Array.from({length:9},()=>Array(9).fill(null)),o=(c,v,f,w)=>{t[v-1][c-1]={kind:f,side:w}};o(1,1,"\u9999","W"),o(2,1,"\u6842","W"),o(3,1,"\u9280","W"),o(4,1,"\u91D1","W"),o(5,1,"\u738B","W"),o(6,1,"\u91D1","W"),o(7,1,"\u9280","W"),o(8,1,"\u6842","W"),o(9,1,"\u9999","W"),o(8,2,"\u98DB","W"),o(2,2,"\u89D2","W");for(let c=1;c<=9;c++)o(c,3,"\u6B69","W");for(let c=1;c<=9;c++)o(c,7,"\u6B69","B");return o(2,8,"\u98DB","B"),o(8,8,"\u89D2","B"),o(1,9,"\u9999","B"),o(2,9,"\u6842","B"),o(3,9,"\u9280","B"),o(4,9,"\u91D1","B"),o(5,9,"\u7389","B"),o(6,9,"\u91D1","B"),o(7,9,"\u9280","B"),o(8,9,"\u6842","B"),o(9,9,"\u9999","B"),t}function Se(t){switch(t){case"\u6B69":return"\u3068";case"\u9999":return"\u6210\u9999";case"\u6842":return"\u6210\u6842";case"\u9280":return"\u6210\u9280";case"\u89D2":return"\u99AC";case"\u98DB":return"\u9F8D";default:return t}}function ue(t){switch(t){case"\u3068":return"\u6B69";case"\u6210\u9999":return"\u9999";case"\u6210\u6842":return"\u6842";case"\u6210\u9280":return"\u9280";case"\u99AC":return"\u89D2";case"\u9F8D":return"\u98DB";default:return t}}var bt=/(右|左|直|上|引|寄)/g;function gt(t){let o=t;if(!t)return null;let c=t,v=!1,f=!1;c.endsWith("\u4E0D\u6210")?(f=!0,c=c.slice(0,-2)):c.endsWith("\u6210")&&(v=!0,c=c.slice(0,-1)),c=c.replace(bt,"");let w;switch(c){case"\u6B69":case"\u9999":case"\u6842":case"\u9280":case"\u91D1":case"\u89D2":case"\u98DB":case"\u7389":case"\u738B":case"\u3068":case"\u6210\u9999":case"\u6210\u6842":case"\u6210\u9280":case"\u99AC":case"\u9F8D":w=c;break;default:return null}let I=w;if(v&&!f){let A=Se(w);A!==w?I=A:v=!1}return f&&(v=!1),{kind:I,raw:o,promoted:v?!0:void 0,promotionDeclined:f?!0:void 0}}var xt=["\u98DB","\u89D2","\u91D1","\u9280","\u6842","\u9999","\u6B69","\u7389","\u738B"],Mt=new Set(["\u3068","\u6210\u9999","\u6210\u6842","\u6210\u9280","\u99AC","\u9F8D"]);function $e(t){return Mt.has(t)}function qe(t){var K,U;let o={},c={startMoveNumber:1,moves:[],leadVariations:[],isExpanded:!0},v={line:c},f=[v],w=t.split(/\r?\n/),I="((?:\u6210\u9999|\u6210\u6842|\u6210\u9280|\u99AC|\u9F8D|\u3068|\u6B69|\u9999|\u6842|\u9280|\u91D1|\u89D2|\u98DB|\u7389|\u738B)(?:\u53F3|\u5DE6|\u76F4|\u4E0A|\u5F15|\u5BC4)*(?:\u6210|\u4E0D\u6210)?)",A=new RegExp(`^\\s*(\\d+)\\s+((?:\u540C(?:\\s|\u3000)?)|[${pe}1-9${Ce}]{2})${I}(\u6253?)(?:\\((\\d{2})\\))?(?:\\(([^\\)]*)\\))?`),X=/^変化：(\d+)手/;for(let $ of w){let H=$.trimEnd(),g=H.trim();if(!g||g.startsWith("#")||g.startsWith("----"))continue;let d=g.match(X);if(d){let h=parseInt(d[1],10),V=h-1,D,k;if(h===1)D=v;else for(let C=f.length-1;C>=0;C--){let T=f[C],R=T.line.moves.find(te=>te.n===V);if(R){D=T,k=R;break}}for(D||(D=v,k=void 0);f.length&&f[f.length-1]!==D;)f.pop();let Y=k?D.line.moves.indexOf(k)+1:0,z={startMoveNumber:h,moves:[],parent:{line:D.line,anchorMoveCount:Y},leadVariations:[],isExpanded:!1};k?k.variations.push(z):D.line.leadVariations.push(z),f.push({line:z,prevMove:k});continue}if(g.includes("\uFF1A")){let[h,V]=g.split("\uFF1A");h&&V&&(o[h.trim()]=V.trim());continue}if(g.startsWith("*")){let h=f[f.length-1];h.prevMove&&(h.prevMove.comment=(h.prevMove.comment?h.prevMove.comment+`
`:"")+g.slice(1).trim());continue}let m=H.match(A);if(m){let h=f[f.length-1],V=parseInt(m[1],10),D=m[2].replace(/[\s　]/g,""),k;if(D==="\u540C")(K=h.prevMove)!=null&&K.to&&(k={...h.prevMove.to});else try{k=ht(D)}catch(j){k=void 0}if(!k)continue;let Y=gt(m[3]);if(!Y)continue;let{kind:z,raw:C,promoted:T,promotionDeclined:R}=Y,te=m[4]==="\u6253",_;if(m[5]){let j=parseInt(m[5][0],10),B=parseInt(m[5][1],10);_={f:j,r:B}}let ne=(U=m[6])==null?void 0:U.trim(),re={n:V,to:k,from:_,kind:z,rawKind:C,promoted:T,promotionDeclined:R,drop:te,timestamp:ne,rawTo:D||void 0,variations:[],areVariationsExpanded:!1};h.line.moves.push(re),h.prevMove=re}}return{header:o,root:c}}function He(t){return t>=1&&t<=9?pe[t-1]:t.toString()}function yt(t){return`${He(t.f)}${He(t.r)}`}function _e(t){var w,I;let o=t.rawTo==="\u540C"?"\u540C":yt(t.to),c=(I=(w=t.rawKind)!=null?w:t.kind)!=null?I:"",v=t.drop?"\u6253":"",f=!t.drop&&t.from?`(${t.from.f}${t.from.r})`:"";return`${o}${c}${v}${f}`}var fe=class extends Oe.Plugin{async onload(){this.registerMarkdownCodeBlockProcessor("kif",(o,c,v)=>this.renderKif(o,c,v))}renderKif(o,c,v){let f=c.createDiv({cls:"shogi-kif"}),w=o.match(/^[\t ]*(?:[#;]|\/\/)?[\t ]*(?:start(?:-?move)?|開始手(?:数)?|表示開始手(?:数)?|初期表示手(?:数)?)[\t ]*(?:[:：=])[\t ]*(\d+)/im),I=w?parseInt(w[1],10):void 0,{header:A,root:X}=qe(o),K=ke(),U={B:[],W:[]},$,H,g,d=X,m=0,h=new WeakMap,V=f.createDiv({cls:"toolbar"}),D=V.createEl("button",{text:"\u23EE \u6700\u521D",attr:{type:"button","aria-label":"\u6700\u521D\u306E\u624B\u3078\u79FB\u52D5 (Home)",title:"\u6700\u521D\u306E\u624B\u3078\u79FB\u52D5 (Home)"}}),k=V.createEl("button",{text:"\u25C0 \u4E00\u624B\u623B\u308B",attr:{type:"button","aria-label":"\u4E00\u624B\u623B\u308B (ArrowLeft)",title:"\u4E00\u624B\u623B\u308B (ArrowLeft)"}}),Y=V.createEl("button",{text:"\u4E00\u624B\u9032\u3080 \u25B6",attr:{type:"button","aria-label":"\u4E00\u624B\u9032\u3080 (ArrowRight)",title:"\u4E00\u624B\u9032\u3080 (ArrowRight)"}}),z=V.createEl("button",{text:"\u6700\u5F8C \u23ED",attr:{type:"button","aria-label":"\u6700\u5F8C\u306E\u624B\u3078\u79FB\u52D5 (End)",title:"\u6700\u5F8C\u306E\u624B\u3078\u79FB\u52D5 (End)"}}),C=V.createEl("button",{text:"\u25B6 \u81EA\u52D5\u518D\u751F",attr:{type:"button","aria-label":"\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)",title:"\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"}}),T=V.createDiv({cls:"start-move-control"});T.createSpan({cls:"start-move-label",text:"\u8868\u793A\u958B\u59CB\u624B:"});let R=T.createEl("input",{cls:"start-move-input",attr:{type:"number",min:"0",step:"1",placeholder:"\u624B\u6570",inputmode:"numeric"}}),te=T.createEl("button",{cls:"start-move-apply",text:"\u79FB\u52D5",attr:{type:"button"}}),_=T.createSpan({cls:"start-move-feedback"}),ne=f.createDiv({cls:"variation-bar"}),re=ne.createSpan({cls:"variation-current"}),j=ne.createEl("button",{text:"\u21A9 \u89AA\u306E\u624B\u9806\u3078"});j.addClass("variation-parent");let B=ne.createEl("select");B.addClass("variation-select");let me=[],Fe=this,Ue=1500,O=!1,ae=null;function ve(){O?(C.setText("\u23F8 \u505C\u6B62"),C.setAttr("aria-label","\u81EA\u52D5\u518D\u751F\u3092\u505C\u6B62 (Space)"),C.setAttr("title","\u81EA\u52D5\u518D\u751F\u3092\u505C\u6B62 (Space)"),C.setAttr("aria-pressed","true")):(C.setText("\u25B6 \u81EA\u52D5\u518D\u751F"),C.setAttr("aria-label","\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"),C.setAttr("title","\u81EA\u52D5\u518D\u751F\u3092\u958B\u59CB (Space)"),C.setAttr("aria-pressed","false"))}function S(){ae!==null&&(window.clearInterval(ae),ae=null),O&&(O=!1,ve())}function ze(){if(O)return;O=!0;let e=window.setInterval(()=>{if(m>=d.moves.length){S();return}L(Math.min(d.moves.length,m+1)),P()},Ue);ae=e,Fe.registerInterval(e),ve()}function Le(){O?S():ze()}let J=f.createDiv({cls:"board-layout"}),ie=J.createDiv({cls:"board-area"}),se=ie.createDiv({cls:"board-wrapper"}),je=se.createDiv({cls:"hands hands-opponent"}),Z=se.createDiv({cls:"board-with-coordinates"}),Je=se.createDiv({cls:"hands hands-player"}),Ge={W:je,B:Je},Pe,Qe=ie.createDiv({cls:"meta"}),q=J.createDiv({cls:"board-move-splitter"});q.setAttr("role","separator"),q.setAttr("aria-hidden","true"),q.setAttr("aria-orientation","horizontal"),q.setAttr("aria-label","\u76E4\u3068\u68CB\u8B5C\u30EA\u30B9\u30C8\u306E\u5883\u754C"),q.tabIndex=-1;let G=J.createDiv({cls:"move-list"});G.createDiv({cls:"move-list-title",text:"\u68CB\u8B5C"});let ee=G.createDiv({cls:"move-list-body"}),we=f.createDiv({cls:"comments-container"}).createDiv({cls:"meta comments"}),ce=!1,he=!1;function De(){let e=Math.round(ie.getBoundingClientRect().height);e>0?G.style.height=`${e}px`:G.style.removeProperty("height"),ce?G.style.flex="0 0 auto":G.style.removeProperty("flex")}function Xe(){De()}function Ye(){let e=J.clientWidth,n=se.getBoundingClientRect().width,r=window.getComputedStyle(G),u=parseFloat(r.minWidth||"0"),i=window.getComputedStyle(J),s=parseFloat(i.columnGap||i.gap||"0"),l=e>0&&n>0?e<n+u+s:e<u+s;l!==ce&&(ce=l,J.toggleClass("is-stacked",ce),q.setAttr("aria-hidden","true"),q.setAttr("aria-orientation","horizontal"),q.tabIndex=-1),Xe()}function oe(){he||(he=!0,window.requestAnimationFrame(()=>{he=!1,Ye()}))}let Te=new ResizeObserver(()=>{oe()});Te.observe(J),this.register(()=>Te.disconnect());let Ve=new ResizeObserver(()=>{De()});Ve.observe(ie),this.register(()=>Ve.disconnect()),this.registerDomEvent(window,"resize",()=>{oe()}),oe();function be(e){if(!e.parent)return"\u672C\u7B4B";let n=e.moves[0],r=n?_e(n):"";return r?`\u5909\u5316 ${e.startMoveNumber}\u624B: ${r}`:`\u5909\u5316 ${e.startMoveNumber}\u624B`}function ge(e,n){let r=Math.max(0,Math.min(n,e.moves.length)),u=e.moves.slice(0,r);if(!e.parent)return u;let i=Math.max(0,Math.min(e.parent.anchorMoveCount,e.parent.line.moves.length));return ge(e.parent.line,i).concat(u)}function Ze(){let e=A.\u6301\u3061\u6642\u9593,n=(b,M)=>{let p=A[M==="B"?"\u5148\u624B":"\u5F8C\u624B"],N=M==="B"?["\u5148\u624B\u6301\u3061\u6642\u9593","\u5148\u624B\u6301\u6642\u9593"]:["\u5F8C\u624B\u6301\u3061\u6642\u9593","\u5F8C\u624B\u6301\u6642\u9593"],F;for(let W of N){let le=A[W];if(le){F=le;break}}return!F&&M==="B"&&e&&(F=e),p&&b.createSpan({cls:"player-name",text:p}),F&&b.createSpan({cls:"player-time",text:F}),b.childElementCount>0},r=b=>{for(let M of mt)b.createSpan({cls:"board-coordinate board-coordinate-file",text:M})},u=b=>{for(let M of vt)b.createSpan({cls:"board-coordinate board-coordinate-rank",text:M})};Z.empty();let i=Z.createDiv({cls:"player-info player-info-opponent"});n(i,"W")||i.remove();let s=Z.createDiv({cls:"board-files board-files-top"});r(s);let l=Z.createDiv({cls:"board-middle"}),a=l.createDiv({cls:"board-ranks board-ranks-left"});u(a),Pe=l.createDiv({cls:"board"});let x=l.createDiv({cls:"board-ranks board-ranks-right"});u(x);let y=Z.createDiv({cls:"board-files board-files-bottom"});r(y);let E=Z.createDiv({cls:"player-info player-info-player"});n(E,"B")||E.remove();for(let b=1;b<=9;b++)for(let M=9;M>=1;M--){let Q=Pe.createDiv({cls:"cell"}),p=K[b-1][M-1];if(p){let N=Q.createSpan({cls:"piece",text:p.kind});p.side==="W"?N.addClass("piece-opponent"):N.addClass("piece-player"),$e(p.kind)&&N.addClass("piece-promoted")}H&&H.f===M&&H.r===b&&Q.addClass("highlight-to"),$&&$.f===M&&$.r===b&&Q.addClass("highlight-from")}}function et(){var n;let e=["W","B"];for(let r of e){let u=Ge[r];u.empty();let i=U[r];if(!i.length){let l=u.createSpan({cls:"hands-empty",text:"\u306A\u3057"});r==="W"&&l.addClass("hand-piece-opponent");continue}let s=new Map;for(let l of i)s.set(l,((n=s.get(l))!=null?n:0)+1);for(let l of xt){let a=s.get(l);if(!a)continue;let x=u.createSpan({cls:"hand-piece",text:a>1?`${l}${a}`:l});r==="W"&&x.addClass("hand-piece-opponent"),s.delete(l)}for(let[l,a]of s){let x=u.createSpan({cls:"hand-piece",text:a>1?`${l}${a}`:l});r==="W"&&x.addClass("hand-piece-opponent")}}}function tt(){let e=[A.\u68CB\u6226?`\u68CB\u6226: ${A.\u68CB\u6226}`:void 0,A.\u6226\u578B?`\u6226\u578B: ${A.\u6226\u578B}`:void 0,g!=null&&g.timestamp?`\u6D88\u8CBB\u6642\u9593: ${g.timestamp}`:void 0].filter(Boolean).join(" / ");Qe.setText(e)}function nt(){if(we.empty(),g!=null&&g.comment){let e=we.createEl("pre");e.textContent=g.comment}}function Ie(e,n){S(),h.set(d,m),d=e;let r=Math.max(0,Math.min(n+1,d.moves.length));L(r),P()}function xe(e,n){let r=e.moves.findIndex(u=>u.n===n);if(r>=0)return{line:e,moveIndex:r};for(let u of e.moves)for(let i of u.variations){let s=xe(i,n);if(s)return s}for(let u of e.leadVariations){let i=xe(u,n);if(i)return i}return null}function Ae(e){if(!Number.isFinite(e)||e<0)return!1;if(S(),e===0)return L(0),P(),!0;let n=xe(X,e);if(!n)return!1;if(n.line===d){let r=Math.max(0,Math.min(n.moveIndex+1,d.moves.length));L(r),P()}else Ie(n.line,n.moveIndex);return!0}function Be(e){if(e.moves.length>0)return!0;for(let n of e.leadVariations)if(Be(n))return!0;return!1}function Me(){var l;if(ee.empty(),!Be(X)){ee.createSpan({cls:"move-list-empty",text:"\u68CB\u8B5C\u306F\u3042\u308A\u307E\u305B\u3093\u3002"}),oe();return}let e=new Set(ge(d,m)),n=new Set,r=d;for(;r;)n.add(r),r=(l=r.parent)==null?void 0:l.line;let u=ee.createDiv({cls:"variation-tree"}),i=(a,x,y)=>{let E=x.createDiv({cls:"variation-node"});E.style.setProperty("--indent-level",y.toString()),n.has(a)&&E.addClass("is-active-line"),a===d&&E.addClass("is-current-line");let b=a.leadVariations.length>0||a.moves.length>0,M=E.createDiv({cls:"variation-header"});if(b){let p=M.createEl("button",{cls:"variation-toggle",text:a.isExpanded?"\u25BC":"\u25B6",attr:{type:"button","aria-expanded":String(a.isExpanded),"aria-label":a.isExpanded?"\u5909\u5316\u3092\u6298\u308A\u305F\u305F\u3080":"\u5909\u5316\u3092\u5C55\u958B\u3059\u308B"}});p.onclick=N=>{N.stopPropagation(),a.isExpanded=!a.isExpanded,Me()}}else M.createSpan({cls:["variation-toggle","variation-toggle-placeholder"]}),E.addClass("is-leaf");if(M.createSpan({cls:"variation-title",text:be(a)}),!b)return;if(!a.isExpanded){E.addClass("is-collapsed");return}let Q=E.createDiv({cls:"variation-children"});for(let p of a.leadVariations)i(p,Q,y+1);a.moves.forEach((p,N)=>{let F=Q.createDiv({cls:"variation-move-group"}),W=F.createDiv({cls:"variation-move"});e.has(p)&&W.addClass("is-done"),g&&g===p&&W.addClass("is-current"),W.onclick=()=>{Ie(a,N)},W.createSpan({cls:"move-number",text:p.n.toString()});let le=p.n%2===1?"\u25B2":"\u25B3",at=p.n%2===1?"move-prefix-sente":"move-prefix-gote";W.createSpan({cls:["move-prefix",at],text:le});let it=W.createSpan({cls:"move-text",text:_e(p)});p.kind&&$e(p.kind)&&it.addClass("move-text-promoted");let Ke=p.variations.length>0,Re=Ke&&p.variations.some(ye=>n.has(ye));if(Ke){W.addClass("has-branch"),Re&&W.addClass("has-active-branch");let ye=W.createEl("button",{cls:"variation-branch-toggle",text:p.areVariationsExpanded?"\u25BC":"\u25B6",attr:{type:"button","aria-expanded":String(p.areVariationsExpanded),"aria-label":p.areVariationsExpanded?"\u3053\u306E\u624B\u306E\u5909\u5316\u3092\u6298\u308A\u305F\u305F\u3080":"\u3053\u306E\u624B\u306E\u5909\u5316\u3092\u5C55\u958B\u3059\u308B"}});if(ye.onclick=de=>{de.stopPropagation(),p.areVariationsExpanded=!p.areVariationsExpanded,Me()},p.areVariationsExpanded){let de=F.createDiv({cls:"variation-branch"});Re&&de.addClass("is-active-branch");for(let st of p.variations)i(st,de,y+1)}}else W.createSpan({cls:"variation-branch-placeholder"})})};i(X,u,0);let s=ee.querySelector(".variation-move.is-current");if(s){let a=ee.getBoundingClientRect(),x=s.getBoundingClientRect();if(x.top<a.top||x.bottom>a.bottom){let y=O?"smooth":"auto";s.scrollIntoView({block:"nearest",inline:"nearest",behavior:y})}}else m===0&&(ee.scrollTop=0);oe()}function L(e){var u;m=Math.max(0,Math.min(e,d.moves.length)),h.set(d,m),K=ke(),U={B:[],W:[]},$=void 0,H=void 0,g=void 0;let r=ge(d,m);for(let i of r){let s=i.n%2===1?"B":"W",l=null;if(i.drop){let y=ue((u=i.kind)!=null?u:"\u6B69"),E=U[s],b=E.findIndex(M=>M===y);b>=0&&E.splice(b,1),l={side:s,kind:y},$=void 0}else if(i.from){let y=K[i.from.r-1][i.from.f-1];if(!y)continue;l={...y},K[i.from.r-1][i.from.f-1]=null,$=i.from}else continue;let a=i.to,x=K[a.r-1][a.f-1];if(x&&x.side!==s){let y=ue(x.kind);U[s].push(y)}l&&(!i.drop&&i.promoted&&(l.kind=Se(l.kind)),!i.drop&&i.promotionDeclined&&!i.kind&&(l.kind=ue(l.kind)),i.kind&&(l.kind=i.kind),K[a.r-1][a.f-1]=l),H=a,g=i}Ze(),et(),tt(),nt(),O&&m>=d.moves.length&&S()}function P(){var i;let e=d;for(;e;){e.isExpanded=!0;let s=e.parent;if(s){let l=s.anchorMoveCount-1;if(l>=0){let a=s.line.moves[l];a&&(a.areVariationsExpanded=!0)}}e=s==null?void 0:s.line}let n=[];for(e=d;e;)n.push(be(e)),e=(i=e.parent)==null?void 0:i.line;re.setText(`\u73FE\u5728: ${n.reverse().join(" \u2192 ")}`);let r=d.parent;j.disabled=!r,j.toggleClass("is-hidden",!r),B.empty(),me=[];let u=[];u.push(...d.leadVariations);for(let s of d.moves)u.push(...s.variations);u.length?(B.removeClass("is-hidden"),B.createEl("option",{text:"\u5909\u5316\u3092\u9078\u629E",value:""}),u.forEach((s,l)=>{var y,E,b;me.push(s);let a=be(s),x=(E=(y=s.parent)==null?void 0:y.anchorMoveCount)!=null?E:0;((b=s.parent)==null?void 0:b.line)===d&&x>m&&(a+="\uFF08\u672A\u5230\u9054\uFF09"),B.createEl("option",{text:a,value:String(l)})}),B.value=""):(B.addClass("is-hidden"),B.value=""),Me()}function ot(e){S(),h.set(d,m),d=e;let n=h.get(d),r=n!==void 0?Math.max(0,Math.min(n,d.moves.length)):0;L(r),P()}function rt(){let e=d.parent;if(!e)return;S(),h.set(d,m),d=e.line;let n=h.get(d),r=n!==void 0?Math.max(0,Math.min(n,d.moves.length)):Math.min(e.anchorMoveCount,d.moves.length);L(r),P()}D.onclick=()=>{S(),L(0),P()},k.onclick=()=>{S(),L(Math.max(0,m-1)),P()},Y.onclick=()=>{S(),L(Math.min(d.moves.length,m+1)),P()},z.onclick=()=>{S(),L(d.moves.length),P()},C.onclick=()=>{Le()},j.onclick=()=>{rt()},B.onchange=()=>{let e=B.value;if(!e)return;let n=parseInt(e,10);if(Number.isNaN(n))return;let r=me[n];r&&ot(r)};function We(){let e=R.value.trim();if(!e){T.removeClass("has-error"),_.setText("");return}let n=parseInt(e,10);if(Number.isNaN(n)){T.addClass("has-error"),_.setText("\u624B\u6570\u306F\u6570\u5B57\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}Ae(n)?(T.removeClass("has-error"),_.setText(""),R.value=n.toString()):(T.addClass("has-error"),_.setText("\u6307\u5B9A\u3057\u305F\u624B\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002"))}te.onclick=e=>{e.preventDefault(),We()},R.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),We())}),this.registerDomEvent(document,"keydown",e=>{if(e.defaultPrevented)return;let n=e.target,r=n instanceof HTMLElement?n:null,u=document.activeElement instanceof HTMLElement?document.activeElement:null,i=a=>{if(!a)return!1;if(a.isContentEditable)return!0;let x=a.tagName;return x==="INPUT"||x==="TEXTAREA"||x==="SELECT"};if(i(r)||r&&r.closest('input, textarea, select, [contenteditable="true"]')||i(u)||u&&u.closest('input, textarea, select, [contenteditable="true"]'))return;let s=a=>a?f.contains(a):!1,l=n===document.body;if(s(r)||s(u)||l)switch(e.key){case"ArrowLeft":e.preventDefault(),S(),L(Math.max(0,m-1)),P();break;case"ArrowRight":e.preventDefault(),S(),L(Math.min(d.moves.length,m+1)),P();break;case"Home":e.preventDefault(),S(),L(0),P();break;case"End":e.preventDefault(),S(),L(d.moves.length),P();break;case" ":case"Space":case"Spacebar":e.preventDefault(),Le();break;default:break}}),ve(),L(0),P(),I!==void 0&&!Number.isNaN(I)&&(R.value=I.toString(),Ae(I)||(T.addClass("has-error"),_.setText("\u6307\u5B9A\u3057\u305F\u624B\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002")))}};
